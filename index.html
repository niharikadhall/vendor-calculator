<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenScore - Vendor Selection Dashboard</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 40px;
            color: #333;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .logo img {
            width: 100px;
        }
        .header-text {
            text-align: center;
            flex-grow: 1;
        }
        h1 {
            font-size: 2.5em;
            font-weight: bold;
            color: #2E7D32;
            margin: 0;
        }
        .tagline {
            font-size: 1.1em;
            color: #666;
            margin-top: 5px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            background: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }
        .tab-button.active {
            color: #2E7D32;
            border-bottom: 3px solid #2E7D32;
        }
        .section {
            display: none;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .section.active {
            display: block;
        }
        h2 {
            font-size: 1.8em;
            font-weight: bold;
            color: #2E7D32;
            margin-bottom: 20px;
        }
        h3 {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-size: 1em;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            color: #333;
            background-color: #f9f9f9;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        input[type="checkbox"] {
            margin-right: 10px;
            accent-color: #2E7D32;
        }
        button {
            background-color: #2E7D32;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background-color: #1B5E20;
        }
        .results {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
        }
        .score-box {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            color: white;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
        }
        .green { background-color: #2E7D32; }
        .yellow { background-color: #FBC02D; }
        .red { background-color: #D32F2F; }
        .error {
            color: #D32F2F;
            text-align: center;
            margin-top: 10px;
            font-size: 1em;
        }
        .stars {
            color: #FBC02D;
            font-size: 1.2em;
            margin-top: 10px;
        }
        .meter {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 20px auto;
        }
        .meter svg {
            transform: rotate(-90deg);
        }
        .meter circle {
            fill: none;
            stroke-width: 10;
        }
        .meter .bg {
            stroke: #ddd;
        }
        .meter .progress {
            stroke: #2E7D32;
            stroke-dasharray: 251.2;
            stroke-dashoffset: 0;
        }
        .meter .progress.yellow {
            stroke: #FBC02D;
        }
        .meter .progress.red {
            stroke: #D32F2F;
        }
        .meter span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        .chart {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .bar {
            width: 50px;
            background-color: #ddd;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .bar-fill {
            background-color: #2E7D32;
            width: 100%;
            position: absolute;
            bottom: 0;
            transition: height 0.5s;
        }
        .bar-fill.yellow {
            background-color: #FBC02D;
        }
        .bar-fill.red {
            background-color: #D32F2F;
        }
        .bar-label {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }
        .material-subcategory, .material-detail {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <img src="https://via.placeholder.com/100x40.png?text=Saivana+Garments" alt="Saivana Garments Pvt Ltd Logo">
        </div>
        <div class="header-text">
            <h1>GreenScore</h1>
            <div class="tagline">Rank vendors based on sustainability metrics</div>
        </div>
        <div style="width: 100px;"></div>
    </div>

    <div class="tabs">
        <button class="tab-button active" onclick="showTab('formal')">Formal Suppliers</button>
        <button class="tab-button" onclick="showTab('informal')">Informal Suppliers (Artisans)</button>
    </div>

    <!-- Formal Suppliers Section -->
    <div id="formal" class="section active">
        <h2>Formal Suppliers</h2>
        <div>
            <label>Supplier Name:</label>
            <input type="text" id="formal-supplier-name" placeholder="e.g., Supplier A">
        </div>
        <div>
            <label>Supplier Location:</label>
            <input type="text" id="formal-supplier-location" placeholder="e.g., Mumbai, India">
        </div>
        <div>
            <label>Material Type:</label>
            <select id="formal-material-type" onchange="updateFormalMaterialOptions()">
                <option value="">-- Select Material Type --</option>
                <option value="Fabric">Fabric</option>
                <option value="Trims">Trims</option>
            </select>
        </div>
        <div class="material-subcategory" id="formal-material-subcategory">
            <label>Material Subcategory:</label>
            <select id="formal-material-subcategory-select" onchange="updateFormalMaterialDetails()">
                <option value="">-- Select Subcategory --</option>
            </select>
        </div>
        <div class="material-detail" id="formal-material-detail">
            <label>Material Detail:</label>
            <select id="formal-material-detail-select">
                <option value="">-- Select Material Detail --</option>
            </select>
        </div>
        <div>
            <h3>Quality (C1) - 18%</h3>
            <label>Defect Rate (%):</label>
            <input type="number" id="c11" min="0" max="100" step="0.1" placeholder="e.g., 3">
            <label>Rejection Rate (%):</label>
            <input type="number" id="c12" min="0" max="100" step="0.1" placeholder="e.g., 1">
        </div>
        <div>
            <h3>Cost (C2) - 18%</h3>
            <label>Product Cost (₹):</label>
            <input type="number" id="c21" min="0" step="1" placeholder="e.g., 90000">
            <label>Transportation Cost (₹):</label>
            <input type="number" id="c22" min="0" step="1" placeholder="e.g., 8000">
        </div>
        <div>
            <h3>Delivery (C3) - 14%</h3>
            <label>Lead Time (days):</label>
            <input type="number" id="c31" min="0" step="1" placeholder="e.g., 15">
            <label>Order Fulfillment Rate (%):</label>
            <input type="number" id="c32" min="0" max="100" step="0.1" placeholder="e.g., 95">
        </div>
        <div>
            <h3>Service (C4) - 9%</h3>
            <label>Customer Service Rating (1-10):</label>
            <input type="number" id="c41" min="1" max="10" step="1" placeholder="e.g., 9">
            <label>CSR Contribution (%):</label>
            <input type="number" id="c42" min="0" max="100" step="0.1" placeholder="e.g., 70">
        </div>
        <div>
            <h3>Environmental Competency (C5) - 31%</h3>
            <label>Emissions (tons CO₂):</label>
            <input type="number" id="c51" min="0" step="0.1" placeholder="e.g., 80">
            <label>Certifications:</label>
            <input type="checkbox" id="c52_gots"> GOTS (2%)<br>
            <input type="checkbox" id="c52_higg_fem"> Higg FEM (1.4%)<br>
            <input type="checkbox" id="c52_higg_fslm"> Higg FSLM (1.4%)<br>
            <input type="checkbox" id="c52_zdhc"> ZDHC (1.05%)<br>
            <input type="checkbox" id="c52_fair_trade"> Fair Trade (1%)<br>
            <input type="checkbox" id="c52_bci"> BCI (0.35%)<br>
            <input type="checkbox" id="c52_iso"> ISO 14001 (0.21%)<br>
            <input type="checkbox" id="c52_ocs"> Organic Content Standard (0.14%)<br>
            <input type="checkbox" id="c52_none"> No Certifications (0%)<br>
            <label>Pollution Control Units:</label>
            <input type="number" id="c53" min="0" step="0.1" placeholder="e.g., 30">
            <label>Resource Consumption (units):</label>
            <input type="number" id="c54" min="0" step="0.1" placeholder="e.g., 50">
        </div>
        <button onclick="calculateAndSaveFormal()">Calculate & Save</button>
        <div id="formal-error" class="error"></div>
        <div id="formal-results" class="results"></div>
    </div>

    <!-- Informal Suppliers (Artisans) Section -->
    <div id="informal" class="section">
        <h2>Informal Suppliers (Artisans)</h2>
        <div>
            <label>Supplier Name:</label>
            <input type="text" id="informal-supplier-name" placeholder="e.g., Supplier B">
        </div>
        <div>
            <label>Supplier Location:</label>
            <input type="text" id="informal-supplier-location" placeholder="e.g., Jaipur, India">
        </div>
        <div>
            <label>Material Type:</label>
            <select id="informal-material-type" onchange="updateInformalMaterialOptions()">
                <option value="">-- Select Material Type --</option>
                <option value="Fabric">Fabric</option>
                <option value="Trims">Trims</option>
            </select>
        </div>
        <div class="material-subcategory" id="informal-material-subcategory">
            <label>Material Subcategory:</label>
            <select id="informal-material-subcategory-select" onchange="updateInformalMaterialDetails()">
                <option value="">-- Select Subcategory --</option>
            </select>
        </div>
        <div class="material-detail" id="informal-material-detail">
            <label>Material Detail:</label>
            <select id="informal-material-detail-select">
                <option value="">-- Select Material Detail --</option>
            </select>
        </div>
        <div>
            <h3>Artisan Contribution (A1) - 100%</h3>
            <label>Number of Artisans Employed:</label>
            <input type="number" id="a11" min="0" step="1" placeholder="e.g., 32">
            <label>Fair Wages Provided:</label>
            <input type="checkbox" id="a12"> Yes<br>
            <label>Traditional Techniques Used:</label>
            <input type="checkbox" id="a13"> Yes<br>
            <label>Low Environmental Impact:</label>
            <input type="checkbox" id="a14"> Yes<br>
            <label>Production Capacity (meters/month):</label>
            <input type="number" id="a15" min="0" step="1" placeholder="e.g., 200">
            <label>Cost per Unit (₹/meter):</label>
            <input type="number" id="a16" min="0" step="1" placeholder="e.g., 150">
            <label>Lead Time (days):</label>
            <input type="number" id="a17" min="0" step="1" placeholder="e.g., 10">
            <label>Percentage of Sustainable Materials Used (%):</label>
            <input type="number" id="a18" min="0" max="100" step="1" placeholder="e.g., 80">
            <label>Quality Rating (1-10):</label>
            <input type="number" id="a19" min="1" max="10" step="1" placeholder="e.g., 8">
        </div>
        <button onclick="calculateAndSaveInformal()">Calculate & Save</button>
        <div id="informal-error" class="error"></div>
        <div id="informal-results" class="results"></div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwv-HP5C3J8IG2CgmqLxfCDAD7AyZn3vae0trq6WzB2ZDKFwFbLMFwrt6ctACe4M2H_/exec'; // Your Google Apps Script Web App URL
        let formalScore = null;
        let informalScore = null;

        const formalBenchmarks = {
            c21: { min: 80000, max: 120000 },
            c22: { min: 5000, max: 15000 },
            c31: { min: 10, max: 30 },
            c51: { min: 50, max: 200 },
            c53: { min: 10, max: 100 },
            c54: { min: 20, max: 100 }
        };

        const formalWeights = {
            c11: 0.10, c12: 0.08,
            c21: 0.12, c22: 0.06,
            c31: 0.08, c32: 0.06,
            c41: 0.05, c42: 0.04,
            c51: 0.12,
            c52_gots: 0.02, c52_higg_fem: 0.014, c52_higg_fslm: 0.014, c52_zdhc: 0.0105,
            c52_fair_trade: 0.01, c52_bci: 0.0035, c52_iso: 0.0021, c52_ocs: 0.0014,
            c53: 0.06, c54: 0.06
        };

        const informalWeights = {
            a11: 0.2,  // Number of Artisans (20%)
            a12: 0.15, // Fair Wages (15%)
            a13: 0.1,  // Traditional Techniques (10%)
            a14: 0.1,  // Low Environmental Impact (10%)
            a15: 0.15, // Production Capacity (15%)
            a16: 0.1,  // Cost per Unit (10%)
            a17: 0.1,  // Lead Time (10%)
            a18: 0.05, // Sustainable Materials (5%)
            a19: 0.05  // Quality Rating (5%)
        };

        const materialOptions = {
            Fabric: {
                "Natural Fibers": {
                    "Cotton": [
                        "Conventional Cotton",
                        "Organic Cotton (GOTS Certified)",
                        "Recycled Cotton",
                        "Pima Cotton",
                        "Supima Cotton",
                        "Egyptian Cotton",
                        "Mercerized Cotton",
                        "Handwoven Khadi Cotton",
                        "Muslin Cotton (Jamdani, Handloom)"
                    ],
                    "Linen & Hemp": [
                        "Conventional Linen",
                        "Organic Linen",
                        "Belgian Linen (Premium)",
                        "Irish Linen",
                        "Hemp (Conventional)",
                        "Organic Hemp"
                    ],
                    "Silk (Luxury & Sustainable)": [
                        "Mulberry Silk (Conventional)",
                        "Organic Silk",
                        "Ahimsa Silk (Peace Silk)",
                        "Tussar Silk",
                        "Eri Silk",
                        "Muga Silk",
                        "Silk Crepe",
                        "Satin Silk",
                        "Organza Silk",
                        "Chiffon Silk",
                        "Silk Georgette"
                    ],
                    "Wool & Animal Fibers": [
                        "Merino Wool (Fine, Ultrafine)",
                        "Organic Wool (GOTS Certified)",
                        "Recycled Wool",
                        "Cashmere (Mongolian, Italian)",
                        "Pashmina",
                        "Alpaca Wool",
                        "Vicuña (Ultra-luxury wool)",
                        "Mohair",
                        "Camel Hair"
                    ]
                },
                "Synthetic Fibers (Conventional & Sustainable Options)": {
                    "Polyester (PET & Sustainable Options)": [
                        "Conventional Polyester",
                        "Recycled Polyester (rPET)",
                        "Bio-based Polyester"
                    ],
                    "Nylon & Alternatives": [
                        "Conventional Nylon",
                        "Recycled Nylon (Econyl®)"
                    ],
                    "Acrylic & Blends": [
                        "Conventional Acrylic",
                        "Recycled Acrylic"
                    ],
                    "Spandex (Elastane, Lycra®)": [
                        "Conventional Spandex",
                        "Recycled Spandex"
                    ]
                },
                "Cellulose-Based Fibers": [
                    "Conventional Viscose",
                    "FSC-Certified Viscose",
                    "Modal (Lenzing Modal™)",
                    "Lyocell (Tencel™ Lyocell)",
                    "Bamboo Viscose",
                    "Bamboo Lyocell",
                    "Cupro (Bemberg™)",
                    "Acetate & Triacetate"
                ],
                "Luxury Lace & Embellished Fabrics": {
                    "Chantilly Lace": [],
                    "Alençon Lace": [],
                    "Guipure Lace": [],
                    "Beaded/Embroidered Mesh": [],
                    "Tulle & Mesh": [
                        "Luxury Silk Tulle",
                        "Nylon Tulle",
                        "Embroidered Mesh"
                    ],
                    "Velvets & Brocades": [
                        "Silk Velvet",
                        "Devore Velvet",
                        "Crushed Velvet",
                        "Brocade (Silk, Metallic, Jacquard)"
                    ],
                    "Tweed & Bouclé": [
                        "Chanel-style Bouclé",
                        "Wool Tweed"
                    ]
                },
                "Sustainable & Innovative Fabrics": {
                    "Vegan Leather Alternatives": [
                        "Piñatex (Pineapple Leather)",
                        "Mylo™ (Mushroom Leather)",
                        "Apple Leather",
                        "Cactus Leather",
                        "Bio-based Leather"
                    ],
                    "Plant-Based Innovations": [
                        "SeaCell (Seaweed Fiber)",
                        "Orange Fiber",
                        "Banana Fiber"
                    ],
                    "Luxury Organic & Handwoven Fabrics": [
                        "Handwoven Ikat",
                        "Handwoven Jamdani",
                        "Tencel-Wool Blends"
                    ]
                },
                "Cotton Blends": [
                    "Cotton-Polyester Blend",
                    "Cotton-Spandex Blend",
                    "Cotton-Linen Blend",
                    "Organic Cotton-Silk Blend"
                ],
                "Wool Blends": [
                    "Wool-Silk Blend",
                    "Cashmere-Silk Blend",
                    "Wool-Alpaca Blend",
                    "Vicuña-Silk Blend"
                ],
                "Synthetic Blends": [
                    "Polyester-Spandex Blend",
                    "Nylon-Spandex Blend"
                ]
            },
            Trims: {
                "Threads": [
                    "Cotton Thread (Regular, Mercerized, Organic)",
                    "Polyester Thread (Conventional, Recycled)",
                    "Nylon Thread (Conventional, Recycled)",
                    "Silk Thread",
                    "Metallic Embroidery Thread"
                ],
                "Interlinings & Fusings": [
                    "Woven Interlining",
                    "Non-woven Interlining",
                    "Fusible Interlining",
                    "Horsehair Canvas (Luxury Suits)",
                    "Organic Cotton Interfacing"
                ],
                "Buttons": [
                    "Polyester Buttons",
                    "Recycled Polyester Buttons",
                    "Shell Buttons (Mother of Pearl, Troca, Agoya)",
                    "Corozo (Tagua Nut) Buttons (Sustainable)",
                    "Wooden Buttons (Organic, Natural, Handcrafted)",
                    "Metal Buttons (Brass, Stainless Steel, Antique Finish)",
                    "Covered Fabric Buttons",
                    "Horn & Bone Buttons"
                ],
                "Zippers": [
                    "Nylon Zippers",
                    "Metal Zippers (Brass, Antique, Silver, Gunmetal)",
                    "Recycled Polyester Zippers",
                    "Invisible Zippers",
                    "Waterproof Zippers"
                ],
                "Hooks & Fasteners": [
                    "Snap Buttons",
                    "Hook & Eye Closures",
                    "Hook & Bar Closures",
                    "Magnetic Closures"
                ],
                "Elastic & Drawcords": [
                    "Polyester Elastic",
                    "Organic Cotton Elastic",
                    "Recycled Elastic",
                    "Braided Drawcords",
                    "Woven Drawstrings",
                    "Leather Cords"
                ],
                "Labels & Tags": {
                    "Fabric Labels": [
                        "Polyester Woven Labels",
                        "Recycled Polyester Labels",
                        "Organic Cotton Labels",
                        "Satin Labels"
                    ],
                    "Paper & Hang Tags": [
                        "Conventional Paper Hang Tags",
                        "Recycled Kraft Paper Tags",
                        "FSC-Certified Paper Tags",
                        "Seed Paper Tags (Plantable)"
                    ],
                    "Heat Transfer & TPU Labels": [
                        "Silicone Heat Transfer Labels",
                        "TPU Transparent Labels (Luxury Sportswear)"
                    ]
                },
                "Embellishments & Decorative Trims": {
                    "Laces & Ribbons": [
                        "Cotton Lace (Organic, Handmade)",
                        "Polyester Lace",
                        "Silk Lace",
                        "Velvet Ribbon",
                        "Grosgrain Ribbon",
                        "Satin Ribbon"
                    ],
                    "Beads & Sequins": [
                        "Glass Beads",
                        "Wooden Beads",
                        "Swarovski Crystals",
                        "Recycled PET Sequins",
                        "Metal Beads"
                    ],
                    "Embroidery & Appliqués": [
                        "Hand Embroidery",
                        "Machine Embroidery"
                    ],
                    "Piping & Cording": [
                        "Satin Piping",
                        "Cotton Piping",
                        "Metallic Piping",
                        "Rope Cording"
                    ]
                },
                "Sustainable & Innovative Trims": {
                    "Vegan Leather Patches": [
                        "Piñatex (Pineapple Leather) Patches",
                        "Mylo (Mushroom Leather) Patches",
                        "Apple Leather Patches",
                        "Recycled Leather Patches"
                    ],
                    "Eco-Friendly Packaging Trims": [
                        "Biodegradable Polybags",
                        "Recyclable Paper Bags",
                        "Compostable Garment Bags"
                    ],
                    "Alternative Sustainable Trims": [
                        "Hemp Cord",
                        "Bamboo Buttons",
                        "Natural Shell Embellishments",
                        "Organic Cotton Bias Tape"
                    ]
                },
                "Specialty & High-End Trims": {
                    "Luxury Metal Trims": [
                        "Gold Plated Buttons",
                        "Brass & Antique Metal Studs",
                        "Custom Engraved Zipper Pulls"
                    ],
                    "Jewelry-Inspired Trims": [
                        "Pearl Buttons",
                        "Crystal Beaded Chains",
                        "Embellished Brooches"
                    ],
                    "Luxury Suiting & Outerwear Trims": [
                        "Horsehair Interfacing",
                        "Silk Lining Fabric",
                        "Leather Elbow Patches",
                        "Bullion Wire Embroidery"
                    ]
                }
            }
        };

        function updateFormalMaterialOptions() {
            const materialType = document.getElementById('formal-material-type').value;
            const subcategoryDiv = document.getElementById('formal-material-subcategory');
            const subcategorySelect = document.getElementById('formal-material-subcategory-select');
            const detailDiv = document.getElementById('formal-material-detail');
            const detailSelect = document.getElementById('formal-material-detail-select');

            subcategoryDiv.style.display = 'none';
            detailDiv.style.display = 'none';
            subcategorySelect.innerHTML = '<option value="">-- Select Subcategory --</option>';
            detailSelect.innerHTML = '<option value="">-- Select Material Detail --</option>';

            if (materialType) {
                subcategoryDiv.style.display = 'block';
                const subcategories = Object.keys(materialOptions[materialType]);
                subcategories.forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory;
                    option.textContent = subcategory;
                    subcategorySelect.appendChild(option);
                });
            }
        }

        function updateFormalMaterialDetails() {
            const materialType = document.getElementById('formal-material-type').value;
            const subcategory = document.getElementById('formal-material-subcategory-select').value;
            const detailDiv = document.getElementById('formal-material-detail');
            const detailSelect = document.getElementById('formal-material-detail-select');

            detailDiv.style.display = 'none';
            detailSelect.innerHTML = '<option value="">-- Select Material Detail --</option>';

            if (subcategory) {
                const details = materialOptions[materialType][subcategory];
                if (Array.isArray(details)) {
                    if (details.length > 0) {
                        detailDiv.style.display = 'block';
                        details.forEach(detail => {
                            const option = document.createElement('option');
                            option.value = detail;
                            option.textContent = detail;
                            detailSelect.appendChild(option);
                        });
                    }
                } else {
                    detailDiv.style.display = 'block';
                    const subDetails = Object.keys(details);
                    subDetails.forEach(subDetail => {
                        const option = document.createElement('option');
                        option.value = subDetail;
                        option.textContent = subDetail;
                        detailSelect.appendChild(option);
                    });
                }
            }
        }

        function updateInformalMaterialOptions() {
            const materialType = document.getElementById('informal-material-type').value;
            const subcategoryDiv = document.getElementById('informal-material-subcategory');
            const subcategorySelect = document.getElementById('informal-material-subcategory-select');
            const detailDiv = document.getElementById('informal-material-detail');
            const detailSelect = document.getElementById('informal-material-detail-select');

            subcategoryDiv.style.display = 'none';
            detailDiv.style.display = 'none';
            subcategorySelect.innerHTML = '<option value="">-- Select Subcategory --</option>';
            detailSelect.innerHTML = '<option value="">-- Select Material Detail --</option>';

            if (materialType) {
                subcategoryDiv.style.display = 'block';
                const subcategories = Object.keys(materialOptions[materialType]);
                subcategories.forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory;
                    option.textContent = subcategory;
                    subcategorySelect.appendChild(option);
                });
            }
        }

        function updateInformalMaterialDetails() {
            const materialType = document.getElementById('informal-material-type').value;
            const subcategory = document.getElementById('informal-material-subcategory-select').value;
            const detailDiv = document.getElementById('informal-material-detail');
            const detailSelect = document.getElementById('informal-material-detail-select');

            detailDiv.style.display = 'none';
            detailSelect.innerHTML = '<option value="">-- Select Material Detail --</option>';

            if (subcategory) {
                const details = materialOptions[materialType][subcategory];
                if (Array.isArray(details)) {
                    if (details.length > 0) {
                        detailDiv.style.display = 'block';
                        details.forEach(detail => {
                            const option = document.createElement('option');
                            option.value = detail;
                            option.textContent = detail;
                            detailSelect.appendChild(option);
                        });
                    }
                } else {
                    detailDiv.style.display = 'block';
                    const subDetails = Object.keys(details);
                    subDetails.forEach(subDetail => {
                        const option = document.createElement('option');
                        option.value = subDetail;
                        option.textContent = subDetail;
                        detailSelect.appendChild(option);
                    });
                }
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        async function calculateAndSaveFormal() {
            const supplierName = document.getElementById('formal-supplier-name').value.trim();
            const supplierLocation = document.getElementById('formal-supplier-location').value.trim();
            const materialType = document.getElementById('formal-material-type').value;
            const materialSubcategory = document.getElementById('formal-material-subcategory-select').value;
            const materialDetail = document.getElementById('formal-material-detail-select').value;

            if (!supplierName) {
                document.getElementById('formal-error').innerHTML = 'Please enter a supplier name.';
                return;
            }
            if (!supplierLocation) {
                document.getElementById('formal-error').innerHTML = 'Please enter a supplier location.';
                return;
            }
            if (!materialType || !materialSubcategory || !materialDetail) {
                document.getElementById('formal-error').innerHTML = 'Please select material type, subcategory, and detail.';
                return;
            }

            document.getElementById('formal-error').innerHTML = '';
            document.getElementById('formal-results').style.display = 'none';

            try {
                const inputs = {
                    c11: parseFloat(document.getElementById('c11').value) || 0,
                    c12: parseFloat(document.getElementById('c12').value) || 0,
                    c21: parseFloat(document.getElementById('c21').value) || 0,
                    c22: parseFloat(document.getElementById('c22').value) || 0,
                    c31: parseFloat(document.getElementById('c31').value) || 0,
                    c32: parseFloat(document.getElementById('c32').value) || 0,
                    c41: parseFloat(document.getElementById('c41').value) || 0,
                    c42: parseFloat(document.getElementById('c42').value) || 0,
                    c51: parseFloat(document.getElementById('c51').value) || 0,
                    c53: parseFloat(document.getElementById('c53').value) || 0,
                    c54: parseFloat(document.getElementById('c54').value) || 0
                };

                const scores = calculateFormalScores(inputs);
                formalScore = scores.totalFormalScore;

                // Prepare certifications as a comma-separated string
                const certifications = [];
                if (document.getElementById('c52_none').checked) certifications.push('None');
                else {
                    if (document.getElementById('c52_gots').checked) certifications.push('GOTS');
                    if (document.getElementById('c52_higg_fem').checked) certifications.push('Higg FEM');
                    if (document.getElementById('c52_higg_fslm').checked) certifications.push('Higg FSLM');
                    if (document.getElementById('c52_zdhc').checked) certifications.push('ZDHC');
                    if (document.getElementById('c52_fair_trade').checked) certifications.push('Fair Trade');
                    if (document.getElementById('c52_bci').checked) certifications.push('BCI');
                    if (document.getElementById('c52_iso').checked) certifications.push('ISO 14001');
                    if (document.getElementById('c52_ocs').checked) certifications.push('Organic Content Standard');
                }

                // Prepare data to save
                const rowData = [
                    supplierName,
                    supplierLocation,
                    materialType,
                    materialSubcategory,
                    materialDetail,
                    inputs.c11,
                    inputs.c12,
                    inputs.c21,
                    inputs.c22,
                    inputs.c31,
                    inputs.c32,
                    inputs.c41,
                    inputs.c42,
                    inputs.c51,
                    certifications.join(','),
                    inputs.c53,
                    inputs.c54,
                    scores.totalFormalScore.toFixed(2)
                ];

                // Send data to Google Apps Script
                const payload = {
                    sheetName: 'FormalSuppliers',
                    data: rowData
                };

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload),
                    mode: 'cors'
                });

                const result = await response.json();
                if (result.status !== 'success') {
                    throw new Error(`Failed to save data: ${result.message}`);
                }

                displayFormalResults(scores);
            } catch (error) {
                document.getElementById('formal-error').innerHTML = `Error: ${error.message}`;
                console.error('Error in calculateAndSaveFormal:', error);
            }
        }

        function calculateFormalScores(inputs) {
            const clamp = (val) => Math.max(1, Math.min(10, val));
            const scores = {
                c11: clamp(Math.round(1 + inputs.c11 / 10)),
                c12: clamp(Math.round(1 + inputs.c12 / 10)),
                c21: clamp(Math.round(1 + 9 * (inputs.c21 - formalBenchmarks.c21.min) / (formalBenchmarks.c21.max - formalBenchmarks.c21.min))),
                c22: clamp(Math.round(1 + 9 * (inputs.c22 - formalBenchmarks.c22.min) / (formalBenchmarks.c22.max - formalBenchmarks.c22.min))),
                c31: clamp(Math.round(1 + 9 * (inputs.c31 - formalBenchmarks.c31.min) / (formalBenchmarks.c31.max - formalBenchmarks.c31.min))),
                c32: clamp(Math.round(11 - inputs.c32 / 10)),
                c41: clamp(Math.round(11 - inputs.c41)),
                c42: clamp(Math.round(10 - inputs.c42 / 10)),
                c51: clamp(Math.round(1 + 9 * (inputs.c51 - formalBenchmarks.c51.min) / (formalBenchmarks.c51.max - formalBenchmarks.c51.min))),
                c53: clamp(Math.round(1 + 9 * (inputs.c53 - formalBenchmarks.c53.min) / (formalBenchmarks.c53.max - formalBenchmarks.c53.min))),
                c54: clamp(Math.round(1 + 9 * (inputs.c54 - formalBenchmarks.c54.min) / (formalBenchmarks.c54.max - formalBenchmarks.c54.min)))
            };

            let c52Score = 0;
            if (document.getElementById('c52_none').checked) {
                c52Score = 0;
            } else {
                c52Score += document.getElementById('c52_gots').checked ? formalWeights.c52_gots * 10 : 0;
                c52Score += document.getElementById('c52_higg_fem').checked ? formalWeights.c52_higg_fem * 10 : 0;
                c52Score += document.getElementById('c52_higg_fslm').checked ? formalWeights.c52_higg_fslm * 10 : 0;
                c52Score += document.getElementById('c52_zdhc').checked ? formalWeights.c52_zdhc * 10 : 0;
                c52Score += document.getElementById('c52_fair_trade').checked ? formalWeights.c52_fair_trade * 10 : 0;
                c52Score += document.getElementById('c52_bci').checked ? formalWeights.c52_bci * 10 : 0;
                c52Score += document.getElementById('c52_iso').checked ? formalWeights.c52_iso * 10 : 0;
                c52Score += document.getElementById('c52_ocs').checked ? formalWeights.c52_ocs * 10 : 0;
            }

            const weightedScores = {
                c1: (scores.c11 * formalWeights.c11) + (scores.c12 * formalWeights.c12),
                c2: (scores.c21 * formalWeights.c21) + (scores.c22 * formalWeights.c22),
                c3: (scores.c31 * formalWeights.c31) + (scores.c32 * formalWeights.c32),
                c4: (scores.c41 * formalWeights.c41) + (scores.c42 * formalWeights.c42),
                c5: (scores.c51 * formalWeights.c51) + c52Score + (scores.c53 * formalWeights.c53) + (scores.c54 * formalWeights.c54)
            };

            const totalFormalScore = weightedScores.c1 + weightedScores.c2 + weightedScores.c3 + weightedScores.c4 + weightedScores.c5;
            return { ...weightedScores, totalFormalScore };
        }

        function displayFormalResults(scores) {
            const getTrafficLight = (score) => score <= 4 ? 'green' : score <= 7 ? 'yellow' : 'red';
            const totalStars = Math.round((scores.totalFormalScore / 10) * 5);
            const meterProgress = (scores.totalFormalScore / 10) * 251.2;
            const meterClass = getTrafficLight(scores.totalFormalScore);

            document.getElementById('formal-results').innerHTML = `
                <h2>Results</h2>
                <div class="score-box ${getTrafficLight(scores.c1)}">Quality (C1): ${scores.c1.toFixed(2)}</div>
                <div class="score-box ${getTrafficLight(scores.c2)}">Cost (C2): ${scores.c2.toFixed(2)}</div>
                <div class="score-box ${getTrafficLight(scores.c3)}">Delivery (C3): ${scores.c3.toFixed(2)}</div>
                <div class="score-box ${getTrafficLight(scores.c4)}">Service (C4): ${scores.c4.toFixed(2)}</div>
                <div class="score-box ${getTrafficLight(scores.c5)}">Environmental (C5): ${scores.c5.toFixed(2)}</div>
                <div class="score-box ${meterClass}">Total Score: ${scores.totalFormalScore.toFixed(2)}</div>
                <div class="stars">${'★'.repeat(totalStars)}${'☆'.repeat(5 - totalStars)}</div>
                <div class="meter">
                    <svg width="100" height="100">
                        <circle class="bg" cx="50" cy="50" r="40" />
                        <circle class="progress ${meterClass}" cx="50" cy="50" r="40" style="stroke-dashoffset: ${251.2 - meterProgress}" />
                    </svg>
                    <span>${scores.totalFormalScore.toFixed(1)}</span>
                </div>
                ${formalScore && informalScore ? `
                    <div class="chart">
                        <div>
                            <div class="bar" style="height: 100px;">
                                <div class="bar-fill ${getTrafficLight(formalScore)}" style="height: ${(formalScore / 10) * 100}%"></div>
                            </div>
                            <div class="bar-label">Formal</div>
                        </div>
                        <div>
                            <div class="bar" style="height: 100px;">
                                <div class="bar-fill ${getTrafficLight(informalScore)}" style="height: ${(informalScore / 10) * 100}%"></div>
                            </div>
                            <div class="bar-label">Informal</div>
                        </div>
                    </div>
                ` : ''}
            `;
            document.getElementById('formal-results').style.display = 'block';
        }

        async function calculateAndSaveInformal() {
            const supplierName = document.getElementById('informal-supplier-name').value.trim();
            const supplierLocation = document.getElementById('informal-supplier-location').value.trim();
            const materialType = document.getElementById('informal-material-type').value;
            const materialSubcategory = document.getElementById('informal-material-subcategory-select').value;
            const materialDetail = document.getElementById('informal-material-detail-select').value;

            if (!supplierName) {
                document.getElementById('informal-error').innerHTML = 'Please enter a supplier name.';
                return;
            }
            if (!supplierLocation) {
                document.getElementById('informal-error').innerHTML = 'Please enter a supplier location.';
                return;
            }
            if (!materialType || !materialSubcategory || !materialDetail) {
                document.getElementById('informal-error').innerHTML = 'Please select material type, subcategory, and detail.';
                return;
            }

            document.getElementById('informal-error').innerHTML = '';
            document.getElementById('informal-results').style.display = 'none';

            try {
                const inputs = {
                    a11: parseFloat(document.getElementById('a11').value) || 0,
                    a15: parseFloat(document.getElementById('a15').value) || 0,
                    a16: parseFloat(document.getElementById('a16').value) || 0,
                    a17: parseFloat(document.getElementById('a17').value) || 0,
                    a18: parseFloat(document.getElementById('a18').value) || 0,
                    a19: parseFloat(document.getElementById('a19').value) || 0
                };

                const scores = calculateInformalScores(inputs);
                informalScore = scores.totalInformalScore;

                // Prepare data to save
                const rowData = [
                    supplierName,
                    supplierLocation,
                    materialType,
                    materialSubcategory,
                    materialDetail,
                    inputs.a11,
                    document.getElementById('a12').checked ? '1' : '0',
                    document.getElementById('a13').checked ? '1' : '0',
                    document.getElementById('a14').checked ? '1' : '0',
                    inputs.a15,
                    inputs.a16,
                    inputs.a17,
                    inputs.a18,
                    inputs.a19,
                    scores.totalInformalScore.toFixed(2)
                ];

                // Send data to Google Apps Script
                const payload = {
                    sheetName: 'InformalSuppliers',
                    data: rowData
                };

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload),
                    mode: 'cors'
                });

                const result = await response.json();
                if (result.status !== 'success') {
                    throw new Error(`Failed to save data: ${result.message}`);
                }

                displayInformalResults(scores);
            } catch (error) {
                document.getElementById('informal-error').innerHTML = `Error: ${error.message}`;
                console.error('Error in calculateAndSaveInformal:', error);
            }
        }

        function calculateInformalScores(inputs) {
            const clamp = (val) => Math.max(1, Math.min(10, val));
            const scores = {
                a11: clamp(Math.round(1 + 9 * (inputs.a11 / 50))),
                a12: document.getElementById('a12').checked ? 10 : 0,
                a13: document.getElementById('a13').checked ? 10 : 0,
                a14: document.getElementById('a14').checked ? 10 : 0,
                a15: clamp(Math.round(1 + 9 * (inputs.a15 / 500))),
                a16: clamp(Math.round(10 - 9 * ((inputs.a16 - 100) / 400))),
                a17: clamp(Math.round(10 - 9 * ((inputs.a17 - 5) / 15))),
                a18: clamp(Math.round(1 + 9 * (inputs.a18 / 100))),
                a19: clamp(inputs.a19)
            };

            const weightedScores = {
                a1: (scores.a11 * informalWeights.a11) + (scores.a12 * informalWeights.a12) + 
                    (scores.a13 * informalWeights.a13) + (scores.a14 * informalWeights.a14) + 
                    (scores.a15 * informalWeights.a15) + (scores.a16 * informalWeights.a16) + 
                    (scores.a17 * informalWeights.a17) + (scores.a18 * informalWeights.a18) + 
                    (scores.a19 * informalWeights.a19)
            };

            const totalInformalScore = weightedScores.a1;
            return { ...weightedScores, totalInformalScore };
        }

        function displayInformalResults(scores) {
            const getTrafficLight = (score) => score <= 4 ? 'green' : score <= 7 ? 'yellow' : 'red';
            const totalStars = Math.round((scores.totalInformalScore / 10) * 5);
            const meterProgress = (scores.totalInformalScore / 10) * 251.2;
            const meterClass = getTrafficLight(scores.totalInformalScore);

            document.getElementById('informal-results').innerHTML = `
                <h2>Results</h2>
                <div class="score-box ${meterClass}">Artisan Score: ${scores.totalInformalScore.toFixed(2)}</div>
                <div class="stars">${'★'.repeat(totalStars)}${'☆'.repeat(5 - totalStars)}</div>
                <div class="meter">
                    <svg width="100" height="100">
                        <circle class="bg" cx="50" cy="50" r="40" />
                        <circle class="progress ${meterClass}" cx="50" cy="50" r="40" style="stroke-dashoffset: ${251.2 - meterProgress}" />
                    </svg>
                    <span>${scores.totalInformalScore.toFixed(1)}</span>
                </div>
                ${formalScore && informalScore ? `
                    <div class="chart">
                        <div>
                            <div class="bar" style="height: 100px;">
                                <div class="bar-fill ${getTrafficLight(formalScore)}" style="height: ${(formalScore / 10) * 100}%"></div>
                            </div>
                            <div class="bar-label">Formal</div>
                        </div>
                        <div>
                            <div class="bar" style="height: 100px;">
                                <div class="bar-fill ${getTrafficLight(informalScore)}" style="height: ${(informalScore / 10) * 100}%"></div>
                            </div>
                            <div class="bar-label">Informal</div>
                        </div>
                    </div>
                ` : ''}
            `;
            document.getElementById('informal-results').style.display = 'block';
        }
    </script>
</body>
</html>